<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - 102d152bb208d020115bc267fd9f132d57025466 - /work/build/docs/xml/writing_unit_tests.xml</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title"> SpECTRE Documentation Coverage Report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">work/build/docs/xml</a> - writing_unit_tests.xml</td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
             <td class="headerItem">Commit:</td>
             <td class="headerValue"><a target="_blank" href="https://github.com/sxs-collaboration/spectre/commit/102d152bb208d020115bc267fd9f132d57025466">102d152bb208d020115bc267fd9f132d57025466</a></td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-01-05 20:09:09</td>
            <td></td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span><span class="lineCov">          1 : &lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;</span></a>
<a name="2"><span class="lineNum">       2 </span>            : &lt;doxygen xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;compound.xsd&quot; version=&quot;1.8.17&quot;&gt;</a>
<a name="3"><span class="lineNum">       3 </span>            :   &lt;compounddef id=&quot;writing_unit_tests&quot; kind=&quot;page&quot;&gt;</a>
<a name="4"><span class="lineNum">       4 </span>            :     &lt;compoundname&gt;writing_unit_tests&lt;/compoundname&gt;</a>
<a name="5"><span class="lineNum">       5 </span>            :     &lt;title&gt;Writing Unit Tests&lt;/title&gt;</a>
<a name="6"><span class="lineNum">       6 </span>            :     &lt;briefdescription&gt;</a>
<a name="7"><span class="lineNum">       7 </span>            :     &lt;/briefdescription&gt;</a>
<a name="8"><span class="lineNum">       8 </span>            :     &lt;detaileddescription&gt;</a>
<a name="9"><span class="lineNum">       9 </span>            : &lt;para&gt;Unit tests are placed in the appropriate subdirectory of &lt;computeroutput&gt;tests/Unit&lt;/computeroutput&gt;, which mirrors the directory hierarchy of &lt;computeroutput&gt;src&lt;/computeroutput&gt;. The tests are all compiled into individual libraries to keep link time of testing executables low. Typically there should be one test library for each production code library. For example, we have a &lt;computeroutput&gt;DataStructures&lt;/computeroutput&gt; library and a &lt;computeroutput&gt;Test_DataStructures&lt;/computeroutput&gt; library. When adding a new test there are several scenarios that can occur, which are outlined below.&lt;/para&gt;</a>
<a name="10"><span class="lineNum">      10 </span>            : &lt;para&gt;&lt;itemizedlist&gt;</a>
<a name="11"><span class="lineNum">      11 </span>            : &lt;listitem&gt;&lt;para&gt;You are adding a new source file to an existing test library:&lt;linebreak/&gt;</a>
<a name="12"><span class="lineNum">      12 </span>            :  If you are adding a new source file in a directory that already has a &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; simply create the source file, which should be named &lt;computeroutput&gt;Test_ProductionCodeFileBeingTest.cpp&lt;/computeroutput&gt; and add that to the &lt;computeroutput&gt;LIBRARY_SOURCES&lt;/computeroutput&gt; in the &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; file in the same directory you are adding the &lt;computeroutput&gt;cpp&lt;/computeroutput&gt; file.&lt;linebreak/&gt;</a>
<a name="13"><span class="lineNum">      13 </span>            :  If you are adding a new source file to a library but want to place it in a subdirectory you must first create the subdirectory. To provide a concrete example, say you are adding the directory &lt;computeroutput&gt;TensorEagerMath&lt;/computeroutput&gt; to &lt;computeroutput&gt;tests/Unit/DataStructures&lt;/computeroutput&gt;. After creating the directory you must add a call to &lt;computeroutput&gt;add_subdirectory(TensorEagerMath)&lt;/computeroutput&gt; to &lt;computeroutput&gt;tests/Unit/DataStructures/CMakeLists.txt&lt;/computeroutput&gt; &lt;emphasis&gt;before&lt;/emphasis&gt; the call to &lt;computeroutput&gt;add_test_library&lt;/computeroutput&gt; and &lt;emphasis&gt;after&lt;/emphasis&gt; the &lt;computeroutput&gt;LIBRARY_SOURCES&lt;/computeroutput&gt; are set. Next add the file &lt;computeroutput&gt;tests/Unit/DataStructures/TensorEagerMath/CMakeLists.txt&lt;/computeroutput&gt;, which should add the new source files by calling &lt;computeroutput&gt;set&lt;/computeroutput&gt;, e.g. &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;set(LIBRARY_SOURCES&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="14"><span class="lineNum">      14 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;${LIBRARY_SOURCES}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="15"><span class="lineNum">      15 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;Test_ProductionCodeFileBeingTest.cpp&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="16"><span class="lineNum">      16 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;PARENT_SCOPE)&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="17"><span class="lineNum">      17 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="18"><span class="lineNum">      18 </span>            : &lt;para&gt;The &lt;computeroutput&gt;PARENT_SCOPE&lt;/computeroutput&gt; flag tells CMake to make the changes visible in the CMakeLists.txt file that called &lt;computeroutput&gt;add_subdirectory&lt;/computeroutput&gt;. You can now add the &lt;computeroutput&gt;Test_ProductionCodeFileBeingTested.cpp&lt;/computeroutput&gt; source file.&lt;/para&gt;</a>
<a name="19"><span class="lineNum">      19 </span>            : &lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;You are adding a new directory:&lt;linebreak/&gt;</a>
<a name="20"><span class="lineNum">      20 </span>            :  If the directory is a new lowest level directory you must add a &lt;computeroutput&gt;add_subdirectory&lt;/computeroutput&gt; call to &lt;computeroutput&gt;tests/Unit/CMakeLists.txt&lt;/computeroutput&gt;. If it is a new subdirectory you must add a &lt;computeroutput&gt;add_subdirectory&lt;/computeroutput&gt; call to the &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; file in the directory where you are adding the subdirectory. Next you should read the part on adding a new test library.&lt;/para&gt;</a>
<a name="21"><span class="lineNum">      21 </span>            : &lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;You are adding a new test library:&lt;linebreak/&gt;</a>
<a name="22"><span class="lineNum">      22 </span>            :  After creating the subdirectory for the new test library you must add a &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; file. See &lt;computeroutput&gt;tests/Unit/DataStructures/CMakeLists.txt&lt;/computeroutput&gt; for an example of one. The &lt;computeroutput&gt;LIBRARY&lt;/computeroutput&gt; and &lt;computeroutput&gt;LIBRARY_SOURCES&lt;/computeroutput&gt; variables set the name of the test library and the source files to be compiled into it. The library name should be of the format &lt;computeroutput&gt;Test_ProductionLibraryName&lt;/computeroutput&gt;, for example &lt;computeroutput&gt;Test_DataStructures&lt;/computeroutput&gt;. The library sources should be only the source files in the current directory. The &lt;computeroutput&gt;add_subdirectory&lt;/computeroutput&gt; command can be used to add source files in subdirectories to the same library as is done in &lt;computeroutput&gt;tests/Unit/CMakeLists.txt&lt;/computeroutput&gt;. The &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; in &lt;computeroutput&gt;tests/Unit/DataStructures/TensorEagerMath&lt;/computeroutput&gt; is an example of how to add source files to a library from a subdirectory of the library. Note that the setting of &lt;computeroutput&gt;LIBRARY_SOURCES&lt;/computeroutput&gt; here first includes the current &lt;computeroutput&gt;LIBRARY_SOURCES&lt;/computeroutput&gt; and at the end specifies &lt;computeroutput&gt;PARENT_SCOPE&lt;/computeroutput&gt;. The &lt;computeroutput&gt;PARENT_SCOPE&lt;/computeroutput&gt; flag tells CMake to modify the variable in a scope that is visible to the parent directory, i.e. the &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; that called &lt;computeroutput&gt;add_subdirectory&lt;/computeroutput&gt;.&lt;linebreak/&gt;</a>
<a name="23"><span class="lineNum">      23 </span>            :  Finally, in the &lt;computeroutput&gt;CMakeLists.txt&lt;/computeroutput&gt; of your new library you must call &lt;computeroutput&gt;add_test_library&lt;/computeroutput&gt;. Again, see &lt;computeroutput&gt;tests/Unit/DataStructures/CMakeLists.txt&lt;/computeroutput&gt; for an example. The &lt;computeroutput&gt;add_test_library&lt;/computeroutput&gt; function adds a test library with the name of the first argument and the source files of the third argument. The second argument is the path of the library&amp;apos;s directory relative to &lt;computeroutput&gt;tests/Unit&lt;/computeroutput&gt;. For example, for &lt;computeroutput&gt;Test_DataStructures&lt;/computeroutput&gt; it is simply &lt;computeroutput&gt;DataStructures&lt;/computeroutput&gt;. The fourth and final argument to &lt;computeroutput&gt;add_test_library&lt;/computeroutput&gt; are the libraries that must be linked. Typically this should only be the production library you&amp;apos;re testing. For example, &lt;computeroutput&gt;Test_DataStructures&lt;/computeroutput&gt; should specify only &lt;computeroutput&gt;DataStructures&lt;/computeroutput&gt; as the library to link. If you are testing a header-only &amp;quot;library&amp;quot; then you do not link any libraries (they must be linked in by the libraries actually testing your dependencies). In this case the last argument should be &lt;computeroutput&gt;&amp;quot;&amp;quot; # Header-only, link dependencies included from testing lib&lt;/computeroutput&gt;&lt;/para&gt;</a>
<a name="24"><span class="lineNum">      24 </span>            : &lt;/listitem&gt;&lt;/itemizedlist&gt;</a>
<a name="25"><span class="lineNum">      25 </span>            : &lt;/para&gt;</a>
<a name="26"><span class="lineNum">      26 </span>            : &lt;para&gt;All tests must start with &lt;programlisting filename=&quot;.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;comment&quot;&gt;//&lt;sp/&gt;Distributed&lt;sp/&gt;under&lt;sp/&gt;the&lt;sp/&gt;MIT&lt;sp/&gt;License.&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="27"><span class="lineNum">      27 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;comment&quot;&gt;//&lt;sp/&gt;See&lt;sp/&gt;LICENSE.txt&lt;sp/&gt;for&lt;sp/&gt;details.&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="28"><span class="lineNum">      28 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="29"><span class="lineNum">      29 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;preprocessor&quot;&gt;#include&lt;sp/&gt;&amp;quot;&lt;ref refid=&quot;TestingFramework_8hpp&quot; kindref=&quot;compound&quot;&gt;Framework/TestingFramework.hpp&lt;/ref&gt;&amp;quot;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="30"><span class="lineNum">      30 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="31"><span class="lineNum">      31 </span>            : &lt;para&gt;The file &lt;computeroutput&gt;&lt;ref refid=&quot;TestingFramework_8hpp&quot; kindref=&quot;compound&quot;&gt;tests/Unit/Framework/TestingFramework.hpp&lt;/ref&gt;&lt;/computeroutput&gt; must always be the first include in the test file and must be separated from the STL includes by a blank line. All classes and free functions should be in an anonymous/unnamed namespace, e.g. &lt;programlisting filename=&quot;.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;keyword&quot;&gt;namespace&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="32"><span class="lineNum">      32 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;class&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;MyFreeClass&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="33"><span class="lineNum">      33 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;comment&quot;&gt;/*&lt;sp/&gt;...&lt;sp/&gt;*/&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="34"><span class="lineNum">      34 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;};&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="35"><span class="lineNum">      35 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="36"><span class="lineNum">      36 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordtype&quot;&gt;void&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;my_free_function()&lt;sp/&gt;noexcept&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="37"><span class="lineNum">      37 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;comment&quot;&gt;/*&lt;sp/&gt;...&lt;sp/&gt;*/&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="38"><span class="lineNum">      38 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="39"><span class="lineNum">      39 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;comment&quot;&gt;//&lt;sp/&gt;namespace&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="40"><span class="lineNum">      40 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="41"><span class="lineNum">      41 </span>            : &lt;para&gt;This is necessary to avoid symbol redefinition errors during linking.&lt;/para&gt;</a>
<a name="42"><span class="lineNum">      42 </span>            : &lt;para&gt;Test cases are added by using the &lt;computeroutput&gt;SPECTRE_TEST_CASE&lt;/computeroutput&gt; macro. The first argument to the macro is the test name, e.g. &lt;computeroutput&gt;&amp;quot;Unit.DataStructures.Tensor&amp;quot;&lt;/computeroutput&gt;, and the second argument is a list of tags. The tags list is a string where each element is in square brackets. For example, &lt;computeroutput&gt;&amp;quot;[Unit][DataStructures]&amp;quot;&lt;/computeroutput&gt;. The tags should only be the type of test, in this case &lt;computeroutput&gt;Unit&lt;/computeroutput&gt;, and the library being tested, in this case &lt;computeroutput&gt;DataStructures&lt;/computeroutput&gt;. The &lt;computeroutput&gt;SPECTRE_TEST_CASE&lt;/computeroutput&gt; macro should be treated as a function, which means that it should be followed by &lt;computeroutput&gt;{ /* test code */ }&lt;/computeroutput&gt;. For example, &lt;programlisting filename=&quot;Test_Tensor.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;SPECTRE_TEST_CASE(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Unit.DataStructures.Tensor.Frames&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;,&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="43"><span class="lineNum">      43 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;[Unit][DataStructures]&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;)&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="44"><span class="lineNum">      44 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;CHECK(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Logical&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;==&lt;sp/&gt;&lt;ref refid=&quot;group__UtilitiesGroup_1gae1b1a8fbda55342653e23c0806e0ee7b&quot; kindref=&quot;member&quot;&gt;get_output&lt;/ref&gt;(&lt;ref refid=&quot;structFrame_1_1Logical&quot; kindref=&quot;compound&quot;&gt;Frame::Logical&lt;/ref&gt;{}));&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="45"><span class="lineNum">      45 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;CHECK(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Grid&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;==&lt;sp/&gt;&lt;ref refid=&quot;group__UtilitiesGroup_1gae1b1a8fbda55342653e23c0806e0ee7b&quot; kindref=&quot;member&quot;&gt;get_output&lt;/ref&gt;(&lt;ref refid=&quot;structFrame_1_1Grid&quot; kindref=&quot;compound&quot;&gt;Frame::Grid&lt;/ref&gt;{}));&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="46"><span class="lineNum">      46 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;CHECK(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Inertial&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;==&lt;sp/&gt;&lt;ref refid=&quot;group__UtilitiesGroup_1gae1b1a8fbda55342653e23c0806e0ee7b&quot; kindref=&quot;member&quot;&gt;get_output&lt;/ref&gt;(&lt;ref refid=&quot;structFrame_1_1Inertial&quot; kindref=&quot;compound&quot;&gt;Frame::Inertial&lt;/ref&gt;{}));&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="47"><span class="lineNum">      47 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;CHECK(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Distorted&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;==&lt;sp/&gt;&lt;ref refid=&quot;group__UtilitiesGroup_1gae1b1a8fbda55342653e23c0806e0ee7b&quot; kindref=&quot;member&quot;&gt;get_output&lt;/ref&gt;(&lt;ref refid=&quot;structFrame_1_1Distorted&quot; kindref=&quot;compound&quot;&gt;Frame::Distorted&lt;/ref&gt;{}));&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="48"><span class="lineNum">      48 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;CHECK(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;NoFrame&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;==&lt;sp/&gt;&lt;ref refid=&quot;group__UtilitiesGroup_1gae1b1a8fbda55342653e23c0806e0ee7b&quot; kindref=&quot;member&quot;&gt;get_output&lt;/ref&gt;(&lt;ref refid=&quot;structFrame_1_1NoFrame&quot; kindref=&quot;compound&quot;&gt;Frame::NoFrame&lt;/ref&gt;{}));&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="49"><span class="lineNum">      49 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="50"><span class="lineNum">      50 </span>            : &lt;/programlisting&gt;From within a &lt;computeroutput&gt;SPECTRE_TEST_CASE&lt;/computeroutput&gt; you are able to do all the things you would normally do in a C++ function, including calling other functions, setting variables, using lambdas, etc.&lt;/para&gt;</a>
<a name="51"><span class="lineNum">      51 </span>            : &lt;para&gt;The &lt;computeroutput&gt;CHECK&lt;/computeroutput&gt; macro in the above example is provided by &lt;ulink url=&quot;https://github.com/catchorg/Catch2&quot;&gt;Catch2&lt;/ulink&gt; and is used to check conditions. We also provide the &lt;computeroutput&gt;CHECK_ITERABLE_APPROX&lt;/computeroutput&gt; macro which checks if two &lt;computeroutput&gt;double&lt;/computeroutput&gt;s or two iterable containers of &lt;computeroutput&gt;double&lt;/computeroutput&gt;s are approximately equal. &lt;computeroutput&gt;CHECK_ITERABLE_APPROX&lt;/computeroutput&gt; is especially useful for comparing &lt;computeroutput&gt;Tensor&lt;/computeroutput&gt;s, &lt;computeroutput&gt;&lt;ref refid=&quot;classDataVector&quot; kindref=&quot;compound&quot;&gt;DataVector&lt;/ref&gt;&lt;/computeroutput&gt;s, and &lt;computeroutput&gt;Tensor&amp;lt;&lt;ref refid=&quot;classDataVector&quot; kindref=&quot;compound&quot;&gt;DataVector&lt;/ref&gt;&amp;gt;&lt;/computeroutput&gt;s since it will iterate over nested containers as well.&lt;/para&gt;</a>
<a name="52"><span class="lineNum">      52 </span>            : &lt;para&gt;&lt;simplesect kind=&quot;warning&quot;&gt;&lt;para&gt;Catch&amp;apos;s &lt;computeroutput&gt;CHECK&lt;/computeroutput&gt; statement only prints numbers out to approximately 10 digits at most, so you should generally prefer &lt;computeroutput&gt;CHECK_ITERABLE_APPROX&lt;/computeroutput&gt; for checking double precision numbers, unless you want to check that two numbers are bitwise identical.&lt;/para&gt;</a>
<a name="53"><span class="lineNum">      53 </span>            : &lt;/simplesect&gt;</a>
<a name="54"><span class="lineNum">      54 </span>            : All unit tests must finish within a few seconds, the hard limit is 5, but having unit tests that long is strongly discouraged. They should typically complete in less than half a second. Tests that are longer are often no longer testing a small enough unit of code and should either be split into several unit tests or moved to an integration test.&lt;/para&gt;</a>
<a name="55"><span class="lineNum">      55 </span>            : &lt;sect3 id=&quot;writing_unit_tests_1autotoc_md142&quot;&gt;</a>
<a name="56"><span class="lineNum">      56 </span>            : &lt;title&gt;Discovering New and Renamed Tests&lt;/title&gt;</a>
<a name="57"><span class="lineNum">      57 </span>            : &lt;para&gt;When you add a new test to a source file or rename an existing test the change needs to be discovered by the testing infrastructure. This is done by building the target &lt;computeroutput&gt;rebuild_cache&lt;/computeroutput&gt;, e.g. by running &lt;computeroutput&gt;make rebuild_cache&lt;/computeroutput&gt;.&lt;/para&gt;</a>
<a name="58"><span class="lineNum">      58 </span>            : &lt;/sect3&gt;</a>
<a name="59"><span class="lineNum">      59 </span>            : &lt;sect3 id=&quot;writing_unit_tests_1autotoc_md143&quot;&gt;</a>
<a name="60"><span class="lineNum">      60 </span>            : &lt;title&gt;Testing Pointwise Functions&lt;/title&gt;</a>
<a name="61"><span class="lineNum">      61 </span>            : &lt;para&gt;Pointwise functions should generally be tested in two different ways. The first is by taking input from an analytic solution and checking that the computed result is correct. The second is to use the random number generation comparison with Python infrastructure. In this approach the C++ function being tested is re-implemented in Python and the results are compared. Please follow these guidelines:&lt;/para&gt;</a>
<a name="62"><span class="lineNum">      62 </span>            : &lt;para&gt;&lt;itemizedlist&gt;</a>
<a name="63"><span class="lineNum">      63 </span>            : &lt;listitem&gt;&lt;para&gt;The Python implementation should be in a file with the same name as the source file that is being re-implemented and placed in the same directory as its corresponding &lt;computeroutput&gt;Test_*.cpp&lt;/computeroutput&gt; source file.&lt;/para&gt;</a>
<a name="64"><span class="lineNum">      64 </span>            : &lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;The functions should have the same names as the C++ functions they re-implement.&lt;/para&gt;</a>
<a name="65"><span class="lineNum">      65 </span>            : &lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;If a function does sums over tensor indices then &lt;ulink url=&quot;https://docs.scipy.org/doc/numpy/reference/generated/numpy.einsum.html&quot;&gt;&lt;computeroutput&gt;numpy.einsum&lt;/computeroutput&gt;&lt;/ulink&gt; should be used in Python to provide an alternative implementation of the loop structure.&lt;/para&gt;</a>
<a name="66"><span class="lineNum">      66 </span>            : &lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;You can import Python functions from other re-implementations in the &lt;computeroutput&gt;tests/Unit/&lt;/computeroutput&gt; directory to reduce code duplication. Note that the path you pass to &lt;computeroutput&gt;&lt;ref refid=&quot;structpypp_1_1SetupLocalPythonEnvironment&quot; kindref=&quot;compound&quot;&gt;pypp::SetupLocalPythonEnvironment&lt;/ref&gt;&lt;/computeroutput&gt; determines the directory from which you can import Python modules. Either import modules directly from the &lt;computeroutput&gt;tests/Unit/&lt;/computeroutput&gt; directory (e.g. &lt;computeroutput&gt;import PointwiseFunction.GeneralRelativity.Christoffel as christoffel&lt;/computeroutput&gt;) or use relative imports like &lt;computeroutput&gt;from . import Christoffel as christoffel&lt;/computeroutput&gt;. Don&amp;apos;t assume the Python environment is set up in a subdirectory of &lt;computeroutput&gt;tests/Unit/&lt;/computeroutput&gt;.&lt;/para&gt;</a>
<a name="67"><span class="lineNum">      67 </span>            : &lt;/listitem&gt;&lt;listitem&gt;&lt;para&gt;The python code is formatted according to the &lt;computeroutput&gt;.style.yapf&lt;/computeroutput&gt; file in the root of the repository.&lt;/para&gt;</a>
<a name="68"><span class="lineNum">      68 </span>            : &lt;/listitem&gt;&lt;/itemizedlist&gt;</a>
<a name="69"><span class="lineNum">      69 </span>            : &lt;/para&gt;</a>
<a name="70"><span class="lineNum">      70 </span>            : &lt;para&gt;It is possible to test C++ functions that return by value and ones that return by &lt;computeroutput&gt;&lt;ref refid=&quot;classgsl_1_1not__null&quot; kindref=&quot;compound&quot;&gt;gsl::not_null&lt;/ref&gt;&lt;/computeroutput&gt;. In the latter case, since it is possible to return multiple values, one Python function taking all non-&lt;computeroutput&gt;&lt;ref refid=&quot;classgsl_1_1not__null&quot; kindref=&quot;compound&quot;&gt;gsl::not_null&lt;/ref&gt;&lt;/computeroutput&gt; arguments must be supplied for each &lt;computeroutput&gt;&lt;ref refid=&quot;classgsl_1_1not__null&quot; kindref=&quot;compound&quot;&gt;gsl::not_null&lt;/ref&gt;&lt;/computeroutput&gt; argument to the C++. To perform the test the &lt;computeroutput&gt;&lt;ref refid=&quot;namespacepypp_1a796819ebc4f228d875772c6d40cc021a&quot; kindref=&quot;member&quot;&gt;pypp::check_with_random_values()&lt;/ref&gt;&lt;/computeroutput&gt; function must be called. For example, the following checks various C++ functions by calling into &lt;computeroutput&gt;pypp&lt;/computeroutput&gt;:&lt;/para&gt;</a>
<a name="71"><span class="lineNum">      71 </span>            : &lt;para&gt;&lt;programlisting filename=&quot;Test_PyppRandomValues.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;pypp::check_with_random_values&amp;lt;2&amp;gt;(&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="72"><span class="lineNum">      72 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&amp;amp;check_double_not_null2&amp;lt;T&amp;gt;,&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;PyppPyTests&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;,&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="73"><span class="lineNum">      73 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;{&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;check_double_not_null2_result0&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;,&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;check_double_not_null2_result1&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;},&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="74"><span class="lineNum">      74 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;{{{0.0,&lt;sp/&gt;10.0},&lt;sp/&gt;{-10.0,&lt;sp/&gt;0.0}}},&lt;sp/&gt;value);&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="75"><span class="lineNum">      75 </span>            : &lt;/programlisting&gt; The corresponding Python functions are:&lt;/para&gt;</a>
<a name="76"><span class="lineNum">      76 </span>            : &lt;para&gt;&lt;programlisting filename=&quot;PyppPyTests.py&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;keyword&quot;&gt;def&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;check_double_not_null2_result0(t0,&lt;sp/&gt;t1):&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="77"><span class="lineNum">      77 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordflow&quot;&gt;return&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;np.sqrt(t0)&lt;sp/&gt;+&lt;sp/&gt;1.0&lt;sp/&gt;/&lt;sp/&gt;np.sqrt(-t1)&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="78"><span class="lineNum">      78 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="79"><span class="lineNum">      79 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="80"><span class="lineNum">      80 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;def&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;check_double_not_null2_result1(t0,&lt;sp/&gt;t1):&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="81"><span class="lineNum">      81 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;keywordflow&quot;&gt;return&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;2.0&lt;sp/&gt;*&lt;sp/&gt;t0&lt;sp/&gt;+&lt;sp/&gt;t1&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="82"><span class="lineNum">      82 </span>            : &lt;/programlisting&gt; &lt;/para&gt;</a>
<a name="83"><span class="lineNum">      83 </span>            : &lt;/sect3&gt;</a>
<a name="84"><span class="lineNum">      84 </span>            : &lt;sect3 id=&quot;writing_unit_tests_1autotoc_md144&quot;&gt;</a>
<a name="85"><span class="lineNum">      85 </span>            : &lt;title&gt;Writing and Fixing Random-Value Based Tests&lt;/title&gt;</a>
<a name="86"><span class="lineNum">      86 </span>            : &lt;para&gt;Many tests in SpECTRE make use of randomly generated numbers in order to increase the parameter space covered by the tests. The random number generator is set up using: &lt;programlisting filename=&quot;.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1gad7f766439113f958bf4f8ba0f53c4881&quot; kindref=&quot;member&quot;&gt;MAKE_GENERATOR&lt;/ref&gt;(gen);&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="87"><span class="lineNum">      87 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="88"><span class="lineNum">      88 </span>            : &lt;para&gt;The generator &lt;computeroutput&gt;gen&lt;/computeroutput&gt; can then be passed to distribution classes such as &lt;computeroutput&gt;&lt;ref refid=&quot;cpp/numeric/random/uniform_real_distribution&quot; kindref=&quot;compound&quot; external=&quot;/__w/spectre/spectre/docs/config/cppreference-doxygen-web.tag.xml&quot;&gt;std::uniform_real_distribution&lt;/ref&gt;&lt;/computeroutput&gt; or &lt;computeroutput&gt;&lt;ref refid=&quot;classUniformCustomDistribution&quot; kindref=&quot;compound&quot;&gt;UniformCustomDistribution&lt;/ref&gt;&lt;/computeroutput&gt;.&lt;/para&gt;</a>
<a name="89"><span class="lineNum">      89 </span>            : &lt;para&gt;Each time the test is run, a different random seed will be used. When writing a test that uses random values, it is good practice to run the test at least &lt;formula id=&quot;2276&quot;&gt;$10^4$&lt;/formula&gt; times in order to set any tolerances on checks used in the test. This can be done by using the following command in the build directory (SPECTRE_BUILD_DIR): &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;ctest&lt;sp/&gt;--repeat-until-fail&lt;sp/&gt;10000&lt;sp/&gt;-R&lt;sp/&gt;TEST_NAME&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="90"><span class="lineNum">      90 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="91"><span class="lineNum">      91 </span>            : &lt;para&gt;where &lt;computeroutput&gt;TEST_NAME&lt;/computeroutput&gt; is the test name passed to &lt;computeroutput&gt;SPECTRE_TEST_CASE&lt;/computeroutput&gt; (e.g. &lt;computeroutput&gt;Unit.Evolution.Systems.CurvedScalarWave.Characteristics&lt;/computeroutput&gt;).&lt;/para&gt;</a>
<a name="92"><span class="lineNum">      92 </span>            : &lt;para&gt;If a test case fails when using a random number generated by &lt;computeroutput&gt;MAKE_GENERATOR&lt;/computeroutput&gt;, as part of the output from the failed test will be the text &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;Seed&lt;sp/&gt;is:&lt;sp/&gt;&lt;sp/&gt;SEED&lt;sp/&gt;from&lt;sp/&gt;FILE_NAME:LINE_NUMBER&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="93"><span class="lineNum">      93 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="94"><span class="lineNum">      94 </span>            : &lt;para&gt;Note that the output of tests can be found in &lt;computeroutput&gt;SPECTRE_BUILD_DIR/Testing/Temporary/LastTest.log&lt;/computeroutput&gt;&lt;/para&gt;</a>
<a name="95"><span class="lineNum">      95 </span>            : &lt;para&gt;The failing test case can then be reproduced by changing &lt;computeroutput&gt;MAKE_GENERATOR&lt;/computeroutput&gt; call at the provided line in the given file to &lt;programlisting filename=&quot;.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1gad7f766439113f958bf4f8ba0f53c4881&quot; kindref=&quot;member&quot;&gt;MAKE_GENERATOR&lt;/ref&gt;(gen,&lt;sp/&gt;SEED);&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="96"><span class="lineNum">      96 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="97"><span class="lineNum">      97 </span>            : &lt;para&gt;If the &lt;computeroutput&gt;MAKE_GENERATOR&lt;/computeroutput&gt; is within &lt;computeroutput&gt;&lt;ref refid=&quot;CheckWithRandomValues_8hpp_source&quot; kindref=&quot;compound&quot;&gt;CheckWithRandomValues.hpp&lt;/ref&gt;&lt;/computeroutput&gt;, the failing test case most likely has occurred within a call to &lt;computeroutput&gt;&lt;ref refid=&quot;namespacepypp_1a796819ebc4f228d875772c6d40cc021a&quot; kindref=&quot;member&quot;&gt;pypp::check_with_random_values()&lt;/ref&gt;&lt;/computeroutput&gt;. In such a case, additional information should have been printed to help you determine which call to &lt;computeroutput&gt;&lt;ref refid=&quot;namespacepypp_1a796819ebc4f228d875772c6d40cc021a&quot; kindref=&quot;member&quot;&gt;pypp::check_with_random_values()&lt;/ref&gt;&lt;/computeroutput&gt; has failed. The critical information is the line &lt;programlisting&gt;&lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;function:&lt;sp/&gt;&lt;sp/&gt;FUNCTION_NAME&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="98"><span class="lineNum">      98 </span>            : &lt;/programlisting&gt;&lt;/para&gt;</a>
<a name="99"><span class="lineNum">      99 </span>            : &lt;para&gt;where &lt;computeroutput&gt;FUNCTION_NAME&lt;/computeroutput&gt; should correspond to the third argument of a call to &lt;computeroutput&gt;&lt;ref refid=&quot;namespacepypp_1a796819ebc4f228d875772c6d40cc021a&quot; kindref=&quot;member&quot;&gt;pypp::check_with_random_values()&lt;/ref&gt;&lt;/computeroutput&gt;. The seed that caused the test to fail can then be passed as an additional argument to &lt;computeroutput&gt;&lt;ref refid=&quot;namespacepypp_1a796819ebc4f228d875772c6d40cc021a&quot; kindref=&quot;member&quot;&gt;pypp::check_with_random_values()&lt;/ref&gt;&lt;/computeroutput&gt;, where you may also need to pass in the default value of the comparison tolerance.&lt;/para&gt;</a>
<a name="100"><span class="lineNum">     100 </span>            : &lt;para&gt;Typically, you will need to adjust a tolerance used in a &lt;computeroutput&gt;CHECK&lt;/computeroutput&gt; somewhere in the test in order to get the test to succeed reliably. The function &lt;computeroutput&gt;&lt;ref refid=&quot;namespacepypp_1a796819ebc4f228d875772c6d40cc021a&quot; kindref=&quot;member&quot;&gt;pypp::check_with_random_values()&lt;/ref&gt;&lt;/computeroutput&gt; takes an argument that specifies the lower and upper bounds of random quantities. Typically these should be chosen to be of order unity in order to decrease the chance of occasionally generating large numbers through multiplications which can cause an error above a reasonable tolerance.&lt;/para&gt;</a>
<a name="101"><span class="lineNum">     101 </span>            : &lt;/sect3&gt;</a>
<a name="102"><span class="lineNum">     102 </span>            : &lt;sect3 id=&quot;writing_unit_tests_1autotoc_md145&quot;&gt;</a>
<a name="103"><span class="lineNum">     103 </span>            : &lt;title&gt;Testing Failure Cases&lt;/title&gt;</a>
<a name="104"><span class="lineNum">     104 </span>            : &lt;para&gt;Adding the &amp;quot;attribute&amp;quot; &lt;computeroutput&gt;// [[OutputRegex, Regular expression to match]]&lt;/computeroutput&gt; before the &lt;computeroutput&gt;SPECTRE_TEST_CASE&lt;/computeroutput&gt; macro will force ctest to only pass the particular test if the regular expression is found in the output of the test. This can be used to test error handling. When testing &lt;computeroutput&gt;ASSERT&lt;/computeroutput&gt;s you must mark the &lt;computeroutput&gt;SPECTRE_TEST_CASE&lt;/computeroutput&gt; as &lt;computeroutput&gt;[[noreturn]]&lt;/computeroutput&gt;, add the macro &lt;computeroutput&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1ga4439208ed8accb2887ff47388e91e58b&quot; kindref=&quot;member&quot;&gt;ASSERTION_TEST()&lt;/ref&gt;;&lt;/computeroutput&gt; to the beginning of the test, and also have the test call &lt;computeroutput&gt;ERROR(&amp;quot;Failed to trigger ASSERT</a>
<a name="105"><span class="lineNum">     105 </span>            : in an assertion test&amp;quot;);&lt;/computeroutput&gt; at the end of the test body. The test body should be enclosed between &lt;computeroutput&gt;#ifdef SPECTRE_DEBUG&lt;/computeroutput&gt; and an &lt;computeroutput&gt;#endif&lt;/computeroutput&gt; For example,&lt;/para&gt;</a>
<a name="106"><span class="lineNum">     106 </span>            : &lt;para&gt;&lt;programlisting filename=&quot;Test_AssertAndError.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;comment&quot;&gt;//&lt;sp/&gt;[[OutputRegex,&lt;sp/&gt;Testing&lt;sp/&gt;assert]]&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="107"><span class="lineNum">     107 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;[[noreturn]]&lt;sp/&gt;SPECTRE_TEST_CASE(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Unit.ErrorHandling.Assert&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;,&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="108"><span class="lineNum">     108 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;[Unit][ErrorHandling]&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;)&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="109"><span class="lineNum">     109 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1ga4439208ed8accb2887ff47388e91e58b&quot; kindref=&quot;member&quot;&gt;ASSERTION_TEST&lt;/ref&gt;();&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="110"><span class="lineNum">     110 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;preprocessor&quot;&gt;#ifdef&lt;sp/&gt;SPECTRE_DEBUG&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="111"><span class="lineNum">     111 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;ref refid=&quot;group__ErrorHandlingGroup_1gaf170f3984e3d0f809b2558dbd981ca35&quot; kindref=&quot;member&quot;&gt;ASSERT&lt;/ref&gt;(&lt;/highlight&gt;&lt;highlight class=&quot;keyword&quot;&gt;false&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;,&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Testing&lt;sp/&gt;assert&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;);&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="112"><span class="lineNum">     112 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;ref refid=&quot;group__ErrorHandlingGroup_1ga1d27028c1827976007fe9d29ad3a2f66&quot; kindref=&quot;member&quot;&gt;ERROR&lt;/ref&gt;(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Failed&lt;sp/&gt;to&lt;sp/&gt;trigger&lt;sp/&gt;ASSERT&lt;sp/&gt;in&lt;sp/&gt;an&lt;sp/&gt;assertion&lt;sp/&gt;test&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;);&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="113"><span class="lineNum">     113 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;highlight class=&quot;preprocessor&quot;&gt;#endif&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="114"><span class="lineNum">     114 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="115"><span class="lineNum">     115 </span>            : &lt;/programlisting&gt; If the &lt;computeroutput&gt;#ifdef SPECTRE_DEBUG&lt;/computeroutput&gt; block is omitted then compilers will correctly flag the code as being unreachable which results in warnings.&lt;/para&gt;</a>
<a name="116"><span class="lineNum">     116 </span>            : &lt;para&gt;You can also test &lt;computeroutput&gt;ERROR&lt;/computeroutput&gt;s inside your code. These tests need to have the &lt;computeroutput&gt;OutputRegex&lt;/computeroutput&gt;, and also call &lt;computeroutput&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1gaf962c28abc1a1f014f2a6b32c6f01680&quot; kindref=&quot;member&quot;&gt;ERROR_TEST()&lt;/ref&gt;;&lt;/computeroutput&gt; at the beginning. They do not need the &lt;computeroutput&gt;#ifdef SPECTRE_DEBUG&lt;/computeroutput&gt; block, they can just call have the code that triggers an &lt;computeroutput&gt;ERROR&lt;/computeroutput&gt;. For example,&lt;/para&gt;</a>
<a name="117"><span class="lineNum">     117 </span>            : &lt;para&gt;&lt;programlisting filename=&quot;Test_AssertAndError.cpp&quot;&gt;&lt;codeline&gt;&lt;highlight class=&quot;comment&quot;&gt;//&lt;sp/&gt;[[OutputRegex,&lt;sp/&gt;Testing&lt;sp/&gt;error]]&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="118"><span class="lineNum">     118 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;[[noreturn]]&lt;sp/&gt;SPECTRE_TEST_CASE(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Unit.ErrorHandling.Error&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;,&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="119"><span class="lineNum">     119 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;[Unit][ErrorHandling]&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;)&lt;sp/&gt;{&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="120"><span class="lineNum">     120 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1gaf962c28abc1a1f014f2a6b32c6f01680&quot; kindref=&quot;member&quot;&gt;ERROR_TEST&lt;/ref&gt;();&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="121"><span class="lineNum">     121 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;&lt;sp/&gt;&lt;sp/&gt;&lt;ref refid=&quot;group__ErrorHandlingGroup_1ga1d27028c1827976007fe9d29ad3a2f66&quot; kindref=&quot;member&quot;&gt;ERROR&lt;/ref&gt;(&lt;/highlight&gt;&lt;highlight class=&quot;stringliteral&quot;&gt;&amp;quot;Testing&lt;sp/&gt;error&amp;quot;&lt;/highlight&gt;&lt;highlight class=&quot;normal&quot;&gt;);&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="122"><span class="lineNum">     122 </span>            : &lt;codeline&gt;&lt;highlight class=&quot;normal&quot;&gt;}&lt;/highlight&gt;&lt;/codeline&gt;</a>
<a name="123"><span class="lineNum">     123 </span>            : &lt;/programlisting&gt; Note that a &lt;computeroutput&gt;OutputRegex&lt;/computeroutput&gt; can also be specified in a test that is supposed to succeed with output that matches the regular expression. In this case, the first line of the test should call the macro &lt;computeroutput&gt;&lt;ref refid=&quot;group__TestingFrameworkGroup_1gacd515a98a97cf7fc82e722274b17e7ce&quot; kindref=&quot;member&quot;&gt;OUTPUT_TEST()&lt;/ref&gt;;&lt;/computeroutput&gt;.&lt;/para&gt;</a>
<a name="124"><span class="lineNum">     124 </span>            : &lt;/sect3&gt;</a>
<a name="125"><span class="lineNum">     125 </span>            : &lt;sect2 id=&quot;writing_unit_tests_1autotoc_md146&quot;&gt;</a>
<a name="126"><span class="lineNum">     126 </span>            : &lt;title&gt;Testing Actions&lt;/title&gt;</a>
<a name="127"><span class="lineNum">     127 </span>            : &lt;para&gt;The action testing framework is documented as part of the &lt;computeroutput&gt;&lt;ref refid=&quot;namespaceActionTesting&quot; kindref=&quot;compound&quot;&gt;ActionTesting&lt;/ref&gt;&lt;/computeroutput&gt; namespace.&lt;/para&gt;</a>
<a name="128"><span class="lineNum">     128 </span>            : &lt;/sect2&gt;</a>
<a name="129"><span class="lineNum">     129 </span>            : &lt;sect2 id=&quot;writing_unit_tests_1autotoc_md147&quot;&gt;</a>
<a name="130"><span class="lineNum">     130 </span>            : &lt;title&gt;Building and Running A Single Test File&lt;/title&gt;</a>
<a name="131"><span class="lineNum">     131 </span>            : &lt;para&gt;In cases where low-level header files are frequently being altered and the changes need to be tested, building &lt;computeroutput&gt;RunTests&lt;/computeroutput&gt; becomes extremely time consuming. The &lt;computeroutput&gt;RunSingleTest&lt;/computeroutput&gt; executable in &lt;computeroutput&gt;tests/Unit/RunSingleTest&lt;/computeroutput&gt; allows one to compile only a select few of the test source files and only link in the necessary libraries. To set which test file and libraries are linked into &lt;computeroutput&gt;RunSingleTest&lt;/computeroutput&gt; edit the &lt;computeroutput&gt;tests/Unit/RunSingleTest/CMakeLists.txt&lt;/computeroutput&gt; file. However, do not commit your changes to that file since it is meant to serve as an example. To compile &lt;computeroutput&gt;RunSingleTest&lt;/computeroutput&gt; use &lt;computeroutput&gt;make RunSingleTest&lt;/computeroutput&gt;, and to run it use &lt;computeroutput&gt;BUILD_DIR/bin/RunSingleTest Unit.Test.Name&lt;/computeroutput&gt;.&lt;/para&gt;</a>
<a name="132"><span class="lineNum">     132 </span>            : &lt;para&gt;&lt;simplesect kind=&quot;warning&quot;&gt;&lt;para&gt;&lt;computeroutput&gt;&lt;ref refid=&quot;group__ParallelGroup_1gaccc68e564135958d18110d2847dcc1b3&quot; kindref=&quot;member&quot;&gt;Parallel::abort&lt;/ref&gt;&lt;/computeroutput&gt; does not work correctly in the &lt;computeroutput&gt;RunSingleTest&lt;/computeroutput&gt; executable because a segfault occurs inside Charm++ code after the abort message is printed. &lt;/para&gt;</a>
<a name="133"><span class="lineNum">     133 </span>            : &lt;/simplesect&gt;</a>
<a name="134"><span class="lineNum">     134 </span>            : &lt;/para&gt;</a>
<a name="135"><span class="lineNum">     135 </span>            : &lt;/sect2&gt;</a>
<a name="136"><span class="lineNum">     136 </span>            :     &lt;/detaileddescription&gt;</a>
<a name="137"><span class="lineNum">     137 </span>            :   &lt;/compounddef&gt;</a>
<a name="138"><span class="lineNum">     138 </span>            : &lt;/doxygen&gt;</a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
