<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.8.17"/>
    <style>
        /*!
         * IE10 viewport hack for Surface/desktop Windows 8 bug
         * Copyright 2014-2015 Twitter, Inc.
         * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
         */
        @-webkit-viewport { width: device-width; }
        @-moz-viewport    { width: device-width; }
        @-ms-viewport     { width: device-width; }
        @-o-viewport      { width: device-width; }
        @viewport         { width: device-width; }
      </style>
  <title>SpECTRE: Domain Creation</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="bootstrap.min.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="popper.min.js"></script>
  <script type="text/javascript" src="bootstrap.min.js"></script>
  <script type="text/javascript" src="spectre.js"></script>
  </head>
  <body>
  <div id="top" class="navbar-fixed-top"><!-- do not remove this div, it is closed by doxygen! -->
  <!-- BEGIN TITLEAREA -->
  <div id="titlearea">
  <script type="text/javascript">
  var searchBox = new SearchBox("searchBox", "search",false,'Search');
  </script>
  <div id="main-nav">
    <ul class="sm sm-dox" id="main-menu">
      <li>
      <a href="index.html">
      SpECTRE &#160;
        <span id="projectnumber">v2020.12.07</span>
      </a>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-book"></i><span>Documentation</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 135px;">
            <a href="index.html">
            <i class="octicon octicon-book"></i><span>Introduction</span></a>
          </li>
          <li style="min-width: 135px;">
            <a href="versioning_and_releases.html">
              <i class="octicon octicon-versions"></i><span>Releases</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="installation.html">
              <i class="octicon octicon-desktop-download"></i><span>Installation</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="tutorials.html">
              <i class="octicon octicon-mortar-board"></i><span>User Tutorials</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="dev_guide.html">
              <i class="octicon octicon-gist-secret"></i><span>Dev Guide</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="code_of_conduct.html">
              <i class="octicon octicon-comment-discussion"></i><span>Code of Conduct</span>
            </a>
          </li>
          <li style="min-width: 135px;">
            <a href="contributing_to_spectre.html">
              <i class="octicon octicon-git-pull-request"></i><span>Contributing Guide</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="selected">
          <span id="selected">
            <i class="octicon octicon-code"></i>
              <span>Code Reference</span>
          </span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li style="min-width: 130px;">
            <a href="modules.html">
              <i class="octicon octicon-code"></i>
              <span>Topics</span>
            </a>
          </li>
          <li style="min-width: 130px;">
            <a href="namespaces.html">
              <i class="octicon octicon-gist"></i>
              <span>Namespaces</span>
            </a>
          </li>
        </ul>
      </li>
      <li>
        <a href="files.html">
          <i class="octicon octicon-file-directory"></i><span>Files</span>
        </a>
      </li>
      <li>
        <a href="citelist.html">
          <i class="octicon octicon-file-text"></i><span>Bibliography</span>
        </a>
      </li>
      <li>
        <a href="https://github.com/sxs-collaboration/spectre" target="_blank">
          <i class="octicon octicon-mark-github"></i><span>View on GitHub</span>
        </a>
      </li>
      <!--The Search <li> is added by doxygen later-->
    </ul>
  </div><!-- main-nav -->
  </div><!-- titlearea -->
  <!-- window showing the filter options -->
  <div id="MSearchSelectWindow"  style="position: fixed;"
       onmouseover="return searchBox.OnSearchSelectShow()"
       onmouseout="return searchBox.OnSearchSelectHide()"
       onkeydown="return searchBox.OnSearchSelectKey(event)">
  </div>
  <!-- iframe showing the search results (closed by default) -->
  <div id="MSearchResultsWindow"  style="position: fixed;">
  <iframe src="javascript:void(0)" frameborder="0"
          name="MSearchResults" id="MSearchResults">
  </iframe>
  </div>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Domain Creation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md182"></a>
Domain Decomposition</h2>
<p>The spatial domain on which the solution is computed is divided into non-overlapping cells. For 2D and 3D domains, we use curvilinear quadrilateral and curvilinear hexahedral elements, respectively. The specification of a particular spatial domain is given by the <a class="el" href="classDomainCreator.html" title="Base class for creating Domains from an option string.">DomainCreator</a>. DomainCreators specify the properties of the initial elements (before AMR takes place), which are then used by <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> to create Blocks. Each <a class="el" href="classBlock.html">Block</a> holds a CoordinateMap (described below) as well as information about its neighbors. For geometrical domains, (e.g. rectilinear, spherical) there are a few shortcuts that can be used such that a user does not need to specify by hand the map and neighbor information for each Block; these methods are explained below.</p>
<h1><a class="anchor" id="autotoc_md183"></a>
CoordinateMaps</h1>
<p>Each <a class="el" href="classBlock.html">Block</a> in the <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> must hold a CoordinateMap which describes how to map the logical cube (a domain that goes [-1. 1] in each dimension) to the curvilinear hexahedral element the Block describes. The CoordinateMap also provides the jacobian of the mapping.</p>
<h2><a class="anchor" id="autotoc_md184"></a>
Shortcuts for CoordinateMaps</h2>
<p>For spherical domains, Wedge3D implements the cubed-sphere map, and there exists the method <code>sph_wedge_coordinate_maps</code> in <a class="el" href="DomainHelpers_8hpp.html">Domain/DomainHelpers.hpp</a> to quickly construct six of these maps at once. For rectilinear multicube domains, Affine and Equiangular map the logical cubes to cartesian cubes. The method <code>maps_for_rectilinear_domains</code> in DomainHelpers allows the user to obtain the CoordinateMaps for all of the Blocks in such a domain at once. These can both be used to provide the map arguments to the <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> constructor.</p>
<h1><a class="anchor" id="autotoc_md185"></a>
Boundary Information</h1>
<p>Each <a class="el" href="classBlock.html">Block</a> must know which of the other Blocks in the <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> are its neighbors and which of its logical directions points to an external boundary.</p>
<h2><a class="anchor" id="autotoc_md186"></a>
Shortcuts for Boundary Information</h2>
<p>A quick way to encode the neighbor and boundary information for the blocks in a domain is through our convention of numbering and ordering the corners of the blocks in a well-defined way. The corner numbering scheme is described in the <a class="el" href="tutorial_orientations.html">OrientationMap</a> tutorial. For spherical domains, DomainHelpers has the methods <code>corners_for_radially_layered_domains</code> and <code>corners_for_biradially_layered_domains</code>, which provides the proper corner numberings for the maps obtained from the method <code>sph_wedge_coordinate_maps</code>. These methods are used in the <a class="el" href="classdomain_1_1creators_1_1Shell.html">Shell</a> and <a class="el" href="classdomain_1_1creators_1_1Sphere.html">Sphere</a> DomainCreators. For rectilinear multicube domains, DomainHelpers has the methods <code>corners_for_rectilinear_domains</code>, which provides the proper corner numberings for the maps obtained from the method <code>maps_for_rectilinear_domains</code>.</p>
<h1><a class="anchor" id="autotoc_md187"></a>
Creating Rectilinear Domains with Shortcuts:</h1>
<p>The construction of a rectilinear domain begins with the specification of the total extents of the domain in each cartesian direction, in terms of the number of blocks. These extents are held in an <a class="el" href="classIndex.html">Index</a> object. For an illustrative example, we will explain how to construct a cubical domain which has an extent of two blocks in each dimension:</p>
<div class="image">
<img src="eightcubes.png" alt=""/>
<div class="caption">
A 2x2x2 domain.</div></div>
<p>The first step is to generate the corner numbering for this <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a>. For the purposes of this example, we will construct all blocks with their logical directions aligned with one another. As each block must also have an associated block id, we must be aware of the order in which the corners for each block are constructed.</p>
<p>The algorithm <code>corners_for_rectilinear_domains</code> always begins with the block located in the lowest cartesian corner of the domain. The second block is its immediate neighbor in the \(+x\) direction, and so on until the block in this row with the highest \(x\) coordinate is reached. The next block is the the immediate neighbor of the lowest corner block in the \(+y\) direction, and then continues through the neighboring blocks in the \(+x\) as before. This is the same order in which the global corners numbers are assigned to the vertices of the blocks.</p>
<div class="image">
<img src="eightcubes_numbered.png" alt=""/>
<div class="caption">
With global corners.</div></div>
<p>The block corners generated by <code>corners_for_rectilinear_domains</code> are then:</p>
<div class="fragment"><div class="line">{0,1,3,4,9,10,12,13},</div>
<div class="line">{1,2,4,5,10,11,13,14},</div>
<div class="line">{3,4,6,7,12,13,15,16},</div>
<div class="line">{4,5,7,8,13,14,16,17},</div>
<div class="line">{9,10,12,13,18,19,21,22},</div>
<div class="line">{10,11,13,14,19,20,22,23},</div>
<div class="line">{12,13,15,16,21,22,24,25},</div>
<div class="line">{13,14,16,17,22,23,25,26}</div>
</div><!-- fragment --><p>What remains is to specify the CoordinateMaps that each <a class="el" href="classBlock.html">Block</a> will hold. This is handled by <code>maps_for_rectilinear_domains</code> and currently supports both Affine and Equiangular mappings. The coordinate extents of each map is set by the argument to <code>block_demarcations</code>. For a 2x2x1 domain, the call to <code>maps_for_rectilinear_domains</code> could be:</p>
<div class="fragment"><div class="line">  <span class="keyword">const</span> <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a>&lt;</div>
<div class="line">      <a class="codeRef" href="http://en.cppreference.com/w/cpp/memory/unique_ptr.html">std::unique_ptr&lt;CoordinateMapBase&lt;Frame::Logical, Frame::Inertial, 3&gt;</a>&gt;&gt;</div>
<div class="line">      affine_maps_3d = maps_for_rectilinear_domains&lt;Frame::Inertial&gt;(</div>
<div class="line">          <a class="code" href="classIndex.html">Index&lt;3&gt;</a>{2, 2, 1},</div>
<div class="line">          <a class="codeRef" href="http://en.cppreference.com/w/cpp/container/array.html">std::array&lt;std::vector&lt;double&gt;</a>, 3&gt;{</div>
<div class="line">              {{0.0, 0.5, 2.0}, {0.0, 1.0, 2.0}, {-0.4, 0.3}}},</div>
<div class="line">          {<a class="code" href="classIndex.html">Index&lt;3&gt;</a>{}}, {}, <span class="keyword">false</span>);</div>
</div><!-- fragment --><p> For this choice of arguments we obtain the maps for a domain that extends from 0.0 to 2.0 in the \(x\)-direction, from 0.0 to 2.0 in the \(y\) -direction, and from -0.4 to 0.3 in the \(z\) direction.</p>
<p>With the corners and maps in hand, we can pass these as arguments to the <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> constructor.</p>
<h2><a class="anchor" id="autotoc_md188"></a>
Non-trivial Domain Example</h2>
<p>The aforementioned functions can also take an additional argument to exclude blocks from a domain. For this one needs to know the Index&lt;Dim&gt; for each block they wish to exclude from the domain. For the 2x2x2 domain example, the block indices are:</p>
<div class="fragment"><div class="line">{0,0,0},</div>
<div class="line">{1,0,0},</div>
<div class="line">{0,1,0},</div>
<div class="line">{1,1,0},</div>
<div class="line">{0,0,1},</div>
<div class="line">{1,0,1},</div>
<div class="line">{0,1,1},</div>
<div class="line">{1,1,1}</div>
</div><!-- fragment --><p>In this example, we construct a domain with topology \(S^3\), which begins with the net for a tesseract. We begin by specifying that the domain extents are three blocks along the \(x\) and \(y\) directions, and four blocks along the \(z\) direction. In addition, we exclude the following block indices:</p>
<div class="fragment"><div class="line">{0,0,0}, //first block</div>
<div class="line">{1,0,0}, //second block</div>
<div class="line">{2,0,0}, //third block</div>
<div class="line">{0,1,0}, //fourth block</div>
<div class="line">{2,1,0}, //sixth block</div>
<div class="line">{0,2,0}, //seventh block</div>
<div class="line">{1,2,0}, //eight block</div>
<div class="line">{2,2,0}, //ninth block</div>
<div class="line"> </div>
<div class="line">{0,0,1}, //10th block</div>
<div class="line">{1,0,1}, //11th block</div>
<div class="line">{2,0,1}, //12th block</div>
<div class="line">{0,1,1}, //13th block</div>
<div class="line">{2,1,1}, //15th block</div>
<div class="line">{0,2,1}, //16th block</div>
<div class="line">{1,2,1}, //17th block</div>
<div class="line">{2,2,1}, //18th block</div>
<div class="line"> </div>
<div class="line">{0,0,2}, //19th block</div>
<div class="line">{2,0,2}, //21st block</div>
<div class="line">{0,2,2}, //25th block</div>
<div class="line">{2,2,2}, //27th block</div>
<div class="line"> </div>
<div class="line">{0,0,2}, //28rd block</div>
<div class="line">{1,0,2}, //29th block</div>
<div class="line">{2,0,2}, //30th block</div>
<div class="line">{0,1,2}, //31th block</div>
<div class="line">{2,1,2}, //33th block</div>
<div class="line">{0,2,2}, //34th block</div>
<div class="line">{1,2,2}, //35th block</div>
<div class="line">{2,2,2}, //36th block</div>
</div><!-- fragment --><p>Alternatively, we can exclude none of the blocks in this way and instead selectively copy the block corners from the returned vector into a new vector that only contains the corners for the desired blocks, if one prefers to work with single-number array indices as opposed to tuples.</p>
<p>Either way, we end up with a vector of block corners corresponding to the following diagram:</p>
<div class="image">
<img src="tesseract_numbered.png" alt=""/>
<div class="caption">
A numbered tesseract net.</div></div>
<p>The maps are obtained similarly. In this case we suggest using the Equiangular maps for this <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> since they adapt the logical coordinates to the angular coordinates on a sphere. We also need to identify corresponding faces with each other to obtain a domain of topology \(S^3\), so we also need to supply the constructor of <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a> with PairsOfFaces. For the \(S^3\) domain, these faces are:</p>
<div class="fragment"><div class="line">//Folding highest cube downward:</div>
<div class="line">{{53,54,69,70},{53,54,49,50}},</div>
<div class="line">{{53,57,69,73},{53,57,52,56}},</div>
<div class="line">{{57,58,61,62},{57,58,73,74}},</div>
<div class="line">{{54,58,70,74},{54,58,55,59}},</div>
<div class="line"> </div>
<div class="line">//Folding cross cubes together:</div>
<div class="line">{{54,55,38,39},{54,50,38,34}},</div>
<div class="line">{{58,59,42,43},{58,62,42,46}},</div>
<div class="line">{{53,52,37,36},{53,49,37,33}},</div>
<div class="line">{{57,56,41,40},{57,61,41,45}},</div>
<div class="line"> </div>
<div class="line">//Folding second lowest cube upward:</div>
<div class="line">{{38,42,39,43},{38,42,22,26}},</div>
<div class="line">{{33,34,37,38},{21,22,37,38}},</div>
<div class="line">{{36,37,40,41},{21,37,25,41}},</div>
<div class="line">{{41,42,45,46},{41,42,25,26}},</div>
<div class="line"> </div>
<div class="line">//Folding bottom cube around domain:</div>
<div class="line">{{33,34,49,50},{21,22,5,6}},</div>
<div class="line">{{39,43,55,59},{22,26,6,10}},</div>
<div class="line">{{45,46,61,62},{25,26,9,10}},</div>
<div class="line">{{36,40,52,56},{21,25,5,9}},</div>
<div class="line">{{5,6,9,10},{69,70,73,74}}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="avector_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></div></div>
<div class="ttc" id="aclassIndex_html"><div class="ttname"><a href="classIndex.html">Index</a></div><div class="ttdef"><b>Definition:</b> Index.hpp:31</div></div>
<div class="ttc" id="aarray_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/array.html">std::array</a></div></div>
<div class="ttc" id="aunique_ptr_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/memory/unique_ptr.html">std::unique_ptr</a></div></div>
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
&copy; Copyright 2017 - 2020
<a href="https://black-holes.org">SXS Collaboration</a>,
<a href="LICENSE.txt" target="_blank">
<span class="hidden-xs">Distributed under the</span>
MIT License</a>
</small></address>
</body>
</html>
